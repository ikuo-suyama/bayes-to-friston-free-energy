# Jensenの不等式の直感的理解

**Jensen（イェンセン、またはジェンセン）の不等式は「凸関数のグラフと、それを結ぶ直線（弦）の上下関係」を、平均という操作で言い換えた定理である。**
重みを**比率（どの点を見るか）**と見ると、幾何学的な直感が得られる。

## Jensenの不等式の定義

### 離散版（有限個の点）

有限個の点 $${{x_1, x_2, \ldots, x_n}}$$ と、非負で総和が1となる重み $${{p_1, p_2, \ldots, p_n}}$$ （つまり $${{p_i \ge 0}}$$、$${{\sum_{i=1}^n p_i = 1}}$$）に対して、凸関数 $${{f}}$$ は次を満たす：

$$
f\left(\sum_{i=1}^n p_i x_i\right) \le \sum_{i=1}^n p_i f(x_i)
$$

### 連続版（期待値）

確率変数 $${{X}}$$ と凸関数 $${{f}}$$ に対して：

$$
f(\mathbb{E}[X]) \le \mathbb{E}[f(X)]
$$

これは離散版の極限として理解できる。

## 凸関数の本質

関数 $${{f}}$$ が凸であるとは、**任意の2点を結ぶ直線（弦）が、グラフの上にある**ことをいう。
これは形の主張であり、増減とは無関係である。

数式：

$$
f(\lambda x+(1-\lambda)y)\le \lambda f(x)+(1-\lambda)f(y)\quad(0\le\lambda\le1)
$$

![Jensenの不等式の幾何学的直感](images/Jensen.png)

上の図は、凸関数 $${{f(x) = -\log x}}$$ において、2点 $${{(a, f(a))}}$$ と $${{(b, f(b))}}$$ を結ぶ弦（赤い点線）が、その間のグラフ（黒い曲線）より常に上にあることを示している。重み付き平均の点 $${{\lambda a + (1-\lambda)b}}$$ における関数値 $${{f(\lambda a + (1-\lambda)b)}}$$ は、弦の高さ $${{\lambda f(a) + (1-\lambda)f(b)}}$$ 以下になる。これがJensenの不等式の幾何学的な意味である。

## 二階微分による十分条件

$${{f}}$$ が区間で2回微分可能で

$$
\frac{d^2 f}{dx^2}\ge 0
$$

なら、その区間で $${{f}}$$ は凸である。

意味は明確である。
**傾きが右に行くほど増える → 直線より下に曲がる。**

## Jensenが比較している2つの量

Jensenは同じ横位置で、次の2つを比べる。

- **左辺**：グラフ上の点 $${{f(\lambda x+(1-\lambda)y)}}$$
- **右辺**：弦上の点 $${{​\lambda f(x)+(1-\lambda)f(y)}}$$

凸である限り、**グラフ ≤ 弦** が全ての $${{\lambda}}$$ で同時に成立する。

## 重みの正体

$${{\lambda}}$$ を**弦のどの位置を見るかを指定する比率**と見ると、理解しやすい。

- $${{\lambda=0,1}}$$：端点
- $${{\lambda=\tfrac{1}{2}}}$$：弦の中点
- その他：端点間の任意の位置

この見方では

$$
\lambda f(x)+(1-\lambda)f(y)
$$

は「足し算」ではなく、**弦上の高さの指定**となる。

## なぜ右辺は常に上に来るのか

重要なのは、左辺と右辺が**異なるものを表している**という点である。

- **左辺** $${{f(\lambda x+(1-\lambda)y)}}$$：重み付き平均の点 $${{\lambda x+(1-\lambda)y}}$$ における**グラフ上の実際の高さ**
- **右辺** $${{​\lambda f(x)+(1-\lambda)f(y)}}$$：2つの端点 $${{(x, f(x))}}$$ と $${{(y, f(y))}}$$ を結ぶ**弦上の高さ**を、同じ横位置で測ったもの

言い換えれば、同じ横座標で：
- 左辺は「曲線上を実際に歩いて測った高さ」
- 右辺は「端点を結ぶ直線上で測った高さ」

を比較している。

凸関数の定義「グラフは弦より下にある」とは、まさにこの比較が**すべての $${{\lambda}}$$ で同時に成立する**ことを意味する。$${{\lambda}}$$ をどう選んでも、曲線は直線を突き抜けて上に行くことはない。

## 平均・期待値への拡張

2点の場合から、より多くの点の平均へと拡張できる理由を見ていこう。

### ステップ1：2点から3点へ

3点 $${{x_1, x_2, x_3}}$$ と重み $${{p_1, p_2, p_3}}$$ （$${{p_1+p_2+p_3=1}}$$）を考える。
重み付き平均は次のように**2段階の2点平均**として書ける：

$$
p_1 x_1 + p_2 x_2 + p_3 x_3 = (p_1+p_2)\left(\frac{p_1}{p_1+p_2}x_1 + \frac{p_2}{p_1+p_2}x_2\right) + p_3 x_3
$$

ここで $${{z = \frac{p_1}{p_1+p_2}x_1 + \frac{p_2}{p_1+p_2}x_2}}$$ とおくと、これは $${{x_1}}$$ と $${{x_2}}$$ の重み付き平均である。
また、$${{\frac{p_1}{p_1+p_2} + \frac{p_2}{p_1+p_2} = 1}}$$ なので、2点版のJensen不等式を適用できる：

$$
f(z) = f\left(\frac{p_1}{p_1+p_2}x_1 + \frac{p_2}{p_1+p_2}x_2\right) \le \frac{p_1}{p_1+p_2}f(x_1) + \frac{p_2}{p_1+p_2}f(x_2)
$$

次に、外側の $${{z}}$$ と $${{x_3}}$$ の重み付き平均に対して、再び2点版のJensen不等式を適用する。
$${{(p_1+p_2) + p_3 = 1}}$$ なので：

$$
f(p_1 x_1 + p_2 x_2 + p_3 x_3) = f((p_1+p_2)z + p_3 x_3)
$$

2点版のJensen不等式を適用して：

$$
f((p_1+p_2)z + p_3 x_3) \le (p_1+p_2)f(z) + p_3 f(x_3)
$$

さらに $${{f(z)}}$$ の不等式を代入して：

$$
(p_1+p_2)f(z) + p_3 f(x_3) \le (p_1+p_2)\left(\frac{p_1}{p_1+p_2}f(x_1) + \frac{p_2}{p_1+p_2}f(x_2)\right) + p_3 f(x_3)
$$

右辺を整理すると：

$$
(p_1+p_2)\left(\frac{p_1}{p_1+p_2}f(x_1) + \frac{p_2}{p_1+p_2}f(x_2)\right) + p_3 f(x_3) = p_1 f(x_1) + p_2 f(x_2) + p_3 f(x_3)
$$

こうして、3点版が得られた。

### ステップ2：有限個の点へ

同じ考え方を繰り返すことで、任意の有限個 $${{n}}$$ 個の点に対して：

$$
f\left(\sum_{i=1}^n p_i x_i\right) \le \sum_{i=1}^n p_i f(x_i)
$$

が成り立つ。これは**2点の弦の性質を何度も適用しただけ**で、新しい原理ではない。

### ステップ3：期待値へ

確率変数 $${{X}}$$ の期待値 $${{​\mathbb{E}[X]}}$$ は、有限個の重み付き平均の極限として定義される：

$$
\mathbb{E}[X] = \lim_{n\to\infty} \sum_{i=1}^n p_i^{(n)} x_i^{(n)}
$$

連続的な確率分布の場合、積分形として：

$$
\mathbb{E}[X] = \int_{-\infty}^{\infty} x p(x) dx
$$

ここで $${{p(x)}}$$ は確率密度関数である。

凸関数は連続であるため、不等式は極限操作の下でも保存される。
したがって離散版：

$$
f(\mathbb{E}[X]) = f\left(\sum_i p_i x_i\right) \le \sum_i p_i f(x_i) = \mathbb{E}[f(X)]
$$

連続版（積分形）：

$$
f(\mathbb{E}[X]) = f\left(\int_{-\infty}^{\infty} x p(x) dx\right) \le \int_{-\infty}^{\infty} f(x) p(x) dx = \mathbb{E}[f(X)]
$$

がともに成り立つ。

## 一行で固定

> **Jensenの不等式は、凸なグラフと直線の上下関係を、平均という操作で表現したものにすぎない。**

## 等号成立条件

Jensenの不等式で等号が成立するのは、以下の場合である：

$$
f(\mathbb{E}[X]) = \mathbb{E}[f(X)]
$$

**条件**：
- $${{f}}$$ が**厳密に凸**（strictly convex）の場合：確率変数 $${{X}}$$ が定数（$${{P(X=c)=1}}$$）のときに限り等号が成立
- $${{f}}$$ が線形関数の場合：すべての $${{X}}$$ で等号が成立

幾何学的には、**すべての点が一致する**（ばらつきがゼロ）か、または**関数が直線**（弦とグラフが一致）のときのみ、等号が成り立つ。

情報理論やベイズ推論では、この等号成立条件が最適化問題の解を特徴づける重要な役割を果たす。

## 注意点・例外

### 重みの条件
- 重みは **非負・総和1**（弦・凸結合の条件）
- 期待値版では可測性・積分可能性が前提（厳密には専門家に確認が必要）

### 凹関数の場合

実務では**凹関数**（上に凸）に対してJensenの不等式を使うことが多い。
凹関数では**不等号が逆転**する：

$$
f(\mathbb{E}[X]) \ge \mathbb{E}[f(X)]
$$

**よくある例**：
- **対数関数** $${{f(x) = \log x}}$$：対数尤度の最大化
- **効用関数**：経済学におけるリスク回避的な意思決定
- **エントロピー**：情報理論における不確実性の定量化

凹関数の場合、「平均してから評価する方が大きい」という関係になる。

## 出典

- Jensen, J. L. W. V. (1906), _Sur les fonctions convexes_（一次文献）
- Rockafellar, _Convex Analysis_
- Boyd & Vandenberghe, _Convex Optimization_

## 更新履歴

- 2026-01-21: 初版公開
